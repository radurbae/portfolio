---
import { BASE_URL, normalizePath, toPage } from "@/utils/paths";

const { currentPath = "/" } = Astro.props;

const LINKS = [
  { href: "/", label: "Home", key: "nav.home", icon: "home", iconOnly: true },
  { href: "/about", label: "About", key: "nav.about", icon: "about" },
  { href: "/work", label: "Services", key: "nav.services", icon: "services" },
  { href: "/contact", label: "Contact Us", key: "nav.contact", icon: "contact" }
];

const normalizedCurrentPath = normalizePath(currentPath, BASE_URL);

function isLinkActive(pathname, href) {
  if (href === "/") return pathname === "/";
  return pathname === href || pathname.startsWith(`${href}/`);
}
---

<nav class="relative z-[120] flex items-center overflow-visible rounded-full border border-[#d7d7d7] bg-white/95 px-1.5 py-1 shadow-[0_8px_16px_rgba(0,0,0,0.06)] backdrop-blur">
  <div class="flex items-center gap-1">
    {
      LINKS.map((link) => {
        const active = isLinkActive(normalizedCurrentPath, link.href);

        return (
          <a
            href={toPage(link.href)}
            data-nav-link={link.href}
            aria-label={link.label}
            data-i18n-aria-label={link.key}
            class={`inline-flex items-center rounded-full border text-sm transition-colors ${
              link.iconOnly ? "h-9 w-9 justify-center px-0" : "gap-2 px-3 py-1.5"
            } ${
              active
                ? "border-[#d8d8d8] bg-[#f7f7f7] text-[#121212]"
                : "border-transparent text-[#2f2f2f] hover:bg-[#f3f3f3]"
            }`}
          >
            {link.icon === "home" && (
              <svg viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4">
                <path
                  d="M4 10.7 12 4l8 6.7v8.3A1 1 0 0 1 19 20h-4.5a.5.5 0 0 1-.5-.5V15h-4v4.5a.5.5 0 0 1-.5.5H5a1 1 0 0 1-1-1z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linejoin="round"
                ></path>
              </svg>
            )}
            {link.icon === "about" && (
              <svg viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4">
                <rect x="3.5" y="5.5" width="17" height="13" rx="2.5" fill="none" stroke="currentColor" stroke-width="1.7"></rect>
                <circle cx="8" cy="10" r="1.6" fill="none" stroke="currentColor" stroke-width="1.6"></circle>
                <path d="M6.3 16.5h11.2l-3.5-3.9-2.8 2.7-1.5-1.4z" fill="none" stroke="currentColor" stroke-width="1.6"></path>
              </svg>
            )}
            {link.icon === "services" && (
              <svg viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4">
                <path
                  d="m12 3 2 5 5 2-5 2-2 5-2-5-5-2 5-2z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.7"
                  stroke-linejoin="round"
                ></path>
              </svg>
            )}
            {link.icon === "contact" && (
              <svg viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4">
                <rect x="4" y="4" width="16" height="16" rx="3" fill="none" stroke="currentColor" stroke-width="1.7"></rect>
                <path d="M8 10h8M8 14h6" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"></path>
                <circle cx="9" cy="7.6" r="1.2" fill="currentColor"></circle>
              </svg>
            )}
            {!link.iconOnly && <span data-i18n={link.key}>{link.label}</span>}
          </a>
        );
      })
    }
  </div>
  <span class="mx-1 h-6 w-px bg-[#e1e1e1]"></span>
  <div class="relative inline-flex items-center" data-language-picker>
    <span class="sr-only" data-i18n="nav.language">Language</span>
    <button
      type="button"
      data-language-toggle
      data-i18n-aria-label="nav.language"
      class="language-picker-trigger"
      aria-label="Language"
      aria-expanded="false"
      aria-haspopup="true"
    >
      <span data-language-current>ID</span>
      <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" aria-hidden="true">
        <path d="m6 9 6 6 6-6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </button>
    <div data-language-menu class="language-menu language-menu-compact" role="menu" hidden>
      <button type="button" data-language-option="id" class="language-menu-item" aria-pressed="false" role="menuitemradio">
        <span class="language-code">ID</span>
        <svg class="language-check h-4 w-4" viewBox="0 0 24 24" aria-hidden="true">
          <path d="m6 12 4 4 8-8" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
      </button>
      <button type="button" data-language-option="ar" class="language-menu-item" aria-pressed="false" role="menuitemradio">
        <span class="language-code">AR</span>
        <svg class="language-check h-4 w-4" viewBox="0 0 24 24" aria-hidden="true">
          <path d="m6 12 4 4 8-8" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
      </button>
      <button type="button" data-language-option="en" class="language-menu-item" aria-pressed="false" role="menuitemradio">
        <span class="language-code">EN</span>
        <svg class="language-check h-4 w-4" viewBox="0 0 24 24" aria-hidden="true">
          <path d="m6 12 4 4 8-8" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
      </button>
    </div>
  </div>
  <span class="mx-1 h-6 w-px bg-[#e1e1e1]"></span>
  <button
    type="button"
    data-theme-toggle
    aria-label="Switch to dark mode"
    aria-pressed="false"
    class="inline-flex h-9 w-9 items-center justify-center rounded-full text-[#2f2f2f] transition-colors hover:bg-[#f3f3f3]"
  >
    <svg data-theme-icon="sun" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4">
      <circle cx="12" cy="12" r="3.6" fill="none" stroke="currentColor" stroke-width="1.7"></circle>
      <path
        d="M12 2.8v2.1M12 19.1v2.1M2.8 12h2.1M19.1 12h2.1M5.4 5.4l1.5 1.5M17.1 17.1l1.5 1.5M18.6 5.4l-1.5 1.5M6.9 17.1l-1.5 1.5"
        stroke="currentColor"
        stroke-width="1.7"
        stroke-linecap="round"
      ></path>
    </svg>
    <svg data-theme-icon="moon" viewBox="0 0 24 24" aria-hidden="true" class="hidden h-4 w-4">
      <path
        d="M15.7 3.6a8.6 8.6 0 1 0 4.7 15.8A9.1 9.1 0 0 1 15.7 3.6Z"
        fill="none"
        stroke="currentColor"
        stroke-width="1.7"
        stroke-linejoin="round"
      ></path>
    </svg>
  </button>
</nav>
